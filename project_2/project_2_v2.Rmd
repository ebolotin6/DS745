---
title: "Project 2"
author: "Eli (Ilya) Bolotin"
date: "10/21/2019"
output: word_document
fontsize: 11
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
# Load libraries
if (!require("pacman")) install.packages("pacman")
pacman::p_load(statnet, devtools, UserNetR, igraph, intergraph, igraphdata)
detach(package:igraph)
```

# Load data
```{r}
data(USairports)
```

# Convert igraph to statnet network
```{r}
df <- asDF(USairports) # this works
net1 <- asNetwork(df$edges, vertices=df$vertexes)
```

# Analyze network
```{r}
# view vertex attributes
list.vertex.attributes(net1)

# view edge attributes
list.edge.attributes(net1)

# summary overall of network
summary(net1)

# examine city vertex
head(get.vertex.attribute(net1, "City"))

# view density of network
density.n1 <- gden(net1)

# add vertex attribute to capture degree
net1 %v% "alldeg" <- degree(net1)

# view summary of degree
summary(get.vertex.attribute(net1, "alldeg"))
```

Network density is `density.n1`. The closer to 1 the density is, "the more interconnected the network" [1] (p.14, class text). In the context of this data, density is small because of the hub-and-spoke nature of the airline industry. That is, regional airports connect through central hubs for longer distance flights.


# Examine complete network

```{r}
set.seed(30)
gplot(net1, vertex.col = 2, displaylabels = FALSE)
```

The network is hard to intelligbly decipher due to 23k edges. But the pattern is clear: the network is divided into two primary communities that are connected by central nodes. 

# Subgraph the network  

To get a better sense of the most central nodes

```{r}

n1f <- get.inducedSubgraph(net1, which(net1 %v% "alldeg" >= 20))

```

```{r}
set.seed(30)
gplot(n1f, vertex.col = 2, displaylabels = FALSE)
```


# Visualization and Network Summary

```{r}
# view attribute names
vertex_attr_names(USairports)
edge_attr_names(USairports)

# pull attributes
va <- vertex_attr(USairports)
ea <- edge_attr(USairports)

# view edges and vertices of object
vertices <- V(USairports)
edges <- E(USairports)

# vertices of object
# USairports <- delete_vertex_attr(USairports, "Position")

# Add state as vertex attribute
USairports <- set.vertex.attribute(USairports, "State", index=V(USairports), as.character(sapply(strsplit(V(USairports)$City, ", ", fixed = TRUE), function(x) x[2])))

# View vertex attributes after
va <- vertex_attr(USairports)
va_names <- names(va)
```

## initial plot
```{r}
set.seed(10)

USairports <- simplify(USairports, remove.multiple = T, remove.loops = T)

plot(USairports, vertex.label=NA,
     vertex.size=1, 
     vertex.label.cex = .8, 
     vertex.label.dist=2, 
     edge.arrow.size = .2, 
     layout=layout_with_fr(USairports))
```

## filtering
```{r}
'%ni%' <- Negate('%in%')
# USairports <- simplify(USairports, remove.multiple = T, remove.loops = T)
inCal <- grepl("CA$", V(USairports)$City) 
inNy <- grepl("NY$", V(USairports)$City)
# ny_ca <- E(USairports)[V(USairports)[inCal] %->% V(USairports)[inNy]]
# new_graph <- graph_from_edgelist(ny_ca)
subv = c(V(USairports)[inCal], V(USairports)[inNy])
# calAirports <- induced_subgraph(USairports, inCal)
# nyAirports <- induced_subgraph(USairports, inNy)
bothAirports <- induced_subgraph(USairports, vids=subv)
# bothAirports <- simplify(bothAirports, remove.multiple = T, remove.loops = T)
# USairports <- delete_vertices(USairports, V(USairports)[c("CA","NY") != V(USairports)$State])
```

## colors

```{r}
vertex_attr(bothAirports)$color<-rep("#FF9C0B", length(V(bothAirports))) #coloring all the nodes orange
#Selecting everyone that is "TRUE" in $type to change it to green (take a look at the help of the grep function in case you don't know it).
vertex_attr(bothAirports)$color[grep(pattern = "NY", vertex_attr(bothAirports)$State)]<-"#1C912C"
vertex_attr(bothAirports)$color # checking the color vector
```

## both airports
```{r}
set.seed(10)

bothAirports <- simplify(bothAirports, remove.multiple = T, remove.loops = T)

l = layout_with_fr(bothAirports)

plot(bothAirports, vertex.label=NA, 
     vertex.color = vertex_attr(bothAirports)$color, 
     vertex.size=igraph::degree(bothAirports), 
     vertex.label.cex = .8, 
     vertex.label.dist=2, 
     edge.arrow.size = .2, 
     layout=l)
```

## all airports
```{r}
set.seed(4)
# plot(g4s, vertex.label=V(USairports)$State, vertex.size=1, vertex.label.dist=1, edge.arrow.size = 0)
plot(USairports, vertex.label=NA, vertex.size=1, vertex.label.dist=1, edge.arrow.size = 0, layout=l)
```

```{r}
# d2Vertices <- ego(USairports, nodes = c("JFK","LAX"), order=2)
# JFKNet <- make_ego_graph(USairports, nodes = "JFK", order=2)[[1]]
```


```{r}
# convert back for exporting
# as_data_frame(net, what="edges")
# as_data_frame(net, what="vertices")
```




# Community Detection

# Network modeling


